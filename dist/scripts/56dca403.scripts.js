"use strict";angular.module("faeriaDeckbuilderApp",[]).config(["$routeProvider","$locationProvider",function(a,b){b.html5Mode(!0),a.when("/deckbuilder",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/deckbuilder"})}]),angular.module("faeriaDeckbuilderApp").controller("MainCtrl",["$scope","$location","cards","skipReload",function(a,b,c,d){function e(){d(),b.hash(f(a.deck))}function f(){var b="";for(var c in a.deck)b.length&&(b+=":"),b+=a.deck[c].id+(a.deck[c].quantity>1?","+a.deck[c].quantity:"");return b=(a.deckName?a.deckName:"")+""+"@"+b}function g(b){var c=b.split("@");a.deckName=c[0];var d=b.split("@")[1].split(":");"string"==typeof d&&(d=[d]),d.forEach(function(b){b=b.split(",");var c,d;b.length>1?(c=Number(b[0]),d=Number(b[1])):(c=Number(b[0]),d=1),a.allCards.cards.forEach(function(b){if(b.id===c)for(var e=0;d>e;)a.addToDeck(b),e++})})}a.allCards=c.get(),a.searchText="",a.showBlue=!0,a.showGreen=!0,a.showRed=!0,a.showYellow=!0,a.showHuman=!0,a.showCreature=!0,a.showStructure=!0,a.showEvent=!0,a.showFate=!0,a.showCommon=!0,a.showUncommon=!0,a.showEpic=!0,a.showRare=!0,a.showLegendary=!0,a.isShared=!1,a.error=null,a.deck={},a.filterColumn="name",a.addToDeck=function(b){a.error=null,a.deck[b.name]?a.deck[b.name].quantity<3?a.deck[b.name].quantity++:a.error="limit3":(a.deck[b.name]=b,a.deck[b.name].quantity=1),e()},a.removeFromDeck=function(b){a.error=null,a.deck[b.name].quantity--,a.deck[b.name].quantity||delete a.deck[b.name],e()},a.clearDeck=function(){a.deck={},e()},a.countDeck=function(){var b=0;for(var c in a.deck)b+=a.deck[c].quantity;return b},a.countType=function(b){var c=0;for(var d in a.deck)a.deck[d].type===b&&(c+=a.deck[d].quantity);return c},a.countGold=function(){var b=0;for(var c in a.deck)b+=a.deck[c].gold*a.deck[c].quantity;return b},a.countFaeria=function(){var b=0;for(var c in a.deck)b+=a.deck[c].faeria*a.deck[c].quantity;return b},a.countColor=function(b){var c=0;for(var d in a.deck)a.deck[d].landColor===b&&(c+=a.deck[d].landCost*a.deck[d].quantity);return c},a.countZeroF=function(){var b=0;for(var c in a.deck)"creature"!==a.deck[c].type||Number(a.deck[c].faeria)||(b+=a.deck[c].quantity);return b},a.search=function(b){return"blue"!==b.landColor||a.showBlue?"green"!==b.landColor||a.showGreen?"red"!==b.landColor||a.showRed?"yellow"!==b.landColor||a.showYellow?"human"!==b.landColor||a.showHuman?"creature"!==b.type||a.showCreature?"structure"!==b.type||a.showStructure?"event"!==b.type||a.showEvent?"fate"!==b.type||a.showFate?"C"!==b.rarity||a.showCommon?"U"!==b.rarity||a.showUncommon?"E"!==b.rarity||a.showEpic?"R"!==b.rarity||a.showRare?"L"!==b.rarity||a.showLegendary?-1!==b.name.toLowerCase().indexOf(a.searchText.toLowerCase())?!0:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1},a.sort={column:"name",descending:!1},a.selectedCls=function(b){return b===a.sort.column&&"sort-"+a.sort.descending},a.changeSorting=function(b){var c=a.sort;c.column===b?c.descending=!c.descending:(c.column=b,c.descending=!1)},a.sortDeck={column:"name",descending:!1},a.selectedClsDeck=function(b){return b===a.sortDeck.column&&"sort-"+a.sortDeck.descending},a.changeSortingDeck=function(b){var c=a.sortDeck;c.column===b?c.descending=!c.descending:(c.column=b,c.descending=!1)},a.powerLifeString=function(a){return a.power||a.life?Number(a.power)+"/"+a.life:""},a.$watch("allCards.cards",function(){if(a.allCards.cards.length){var c=b.hash();c&&g(c)}}),a.$watch("deckName",function(){a.deckName&&e()})}]),angular.module("faeriaDeckbuilderApp").service("cards",["$http",function(a){var b=window.alert,c={cards:[]};return a({method:"GET",url:"/cards.json"}).success(function(a){c.cards=a,c.cards.forEach(function(a,b){a.id=b})}).error(function(){b("Could not get card data!")}),{get:function(){return c}}}]),angular.module("faeriaDeckbuilderApp").factory("skipReload",["$route","$rootScope",function(a,b){return function(){var c=a.current,d=b.$on("$locationChangeSuccess",function(){a.current=c,d()})}}]),angular.module("faeriaDeckbuilderApp").directive("landColor",function(){var a=window.$;return{link:function(b,c,d){b.$watch(d.landColor,function(b){b&&a(c).addClass("land-"+b.toLowerCase())})}}}),angular.module("faeriaDeckbuilderApp").filter("toArray",function(){return function(a){return a instanceof Object?Object.keys(a).map(function(b){return Object.defineProperty(a[b],"$key",{value:b})}):a}});